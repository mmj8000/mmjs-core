"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const p=require("node:fs"),r=require("./options.cjs"),C=require("node:path"),b=require("node:fs/promises"),y=require("mime-types"),L=require("node:url"),S={black:"\x1B[30m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m",gray:"\x1B[90m",bgBlack:"\x1B[40m",bgRed:"\x1B[41m",bgGreen:"\x1B[42m",bgYellow:"\x1B[43m",bgBlue:"\x1B[44m",bgMagenta:"\x1B[45m",bgCyan:"\x1B[46m",bgWhite:"\x1B[47m",reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",italic:"\x1B[3m",underline:"\x1B[4m",blink:"\x1B[5m",reverse:"\x1B[7m",hidden:"\x1B[8m"};function m(e,...t){return t.map(n=>S[n]).join("")+e+S.reset}function u(){return m(new Date().toLocaleTimeString(),"gray")+" "+m("[Mock]","cyan","bold")}let a="";const c={success(e){if(a!==e)return a=e,r.logLevelState.isLogSuccess&&console.log(`${u()}`,m(e,"green"))},info(e){if(a!==e)return a=e,r.logLevelState.isLogInfo&&console.log(`${u()}`,e)},wran(e){if(a!==e)return a=e,r.logLevelState.isLogWarn&&console.log(`${u()}`,m(e,"yellow"))},error(e){if(a!==e)return a=e,console.log(`${u()}`,m(e,"red"))}},$={success(e){c.success(e)},info(e){c.info(e)},wran(e){c.wran(e)},error(e){c.error(e)}};function B(e){try{const t=C.dirname(e);p.existsSync(t)||p.mkdirSync(t,{recursive:!0})}catch(t){c.error(t)}}function _(e,t,n,o=!0){B(e),p.writeFile(e,t,n,i=>{i?c.wran(i):o&&c.success(`ðŸ’§ Write File Successify ${e}`)})}async function M(e,t,n,o=!0){B(e);try{await b.appendFile(e,t,n),o&&c.success(`ðŸ’§ Append File Successify ${e}`)}catch(i){c.wran(i)}}function v(e){const t=e.match(/^(https?):\/\/([^\/:]+)(?::(\d+))?(\/.*)?$/i);if(!t)return"invalid_url";const n=t[1],o=t[2],i=t[3]||(n==="https"?"443":"80"),s=(t[4]||"").replace(/\//g,"_");let l=`${o}_${i}`;return s&&s!=="_"&&(l+=s),l.replace(/[^a-z0-9_]/gi,"_").replace(/_+/g,"_").toLowerCase()}function F(e){var l;let t=y.charset(e)||r.serverConfig.encoding||r.allowCharset[0];t=t.toLocaleLowerCase();let n=y.extension(e)||r.customContentTypeToExt[e]||r.serverConfig.fileExt.slice(1),o=!((l=r.serverConfig.templateMimeType)!=null&&l.length)||r.serverConfig.templateMimeType.includes(n),i=r.serverConfig.fileExt,s=r.allowCharset.includes(t)?t:r.allowCharset[0];return o?s=r.allowCharset[0]:i=`.${n}`,{charset:t,encoding:s,isInnerTempType:o,fileExt:i,mimeType:n}}function k(e){return y.contentType(e)}function q(e,t){const o=t.replace(/^[\\/]|[\\/]$/g,"").replace(/\\/g,"/").replace(/\.[^/.]+$/,"").split("/"),i=[...e].sort((s,l)=>l.split(/[\\/]/).length-s.split(/[\\/]/).length);for(const s of i){const f=s.replace(/^[\\/]|[\\/]$/g,"").replace(/\\/g,"/").replace(/\.[^/.]+$/,"").split("/");if(f.length!==o.length)continue;let d=!0;for(let g=0;g<f.length;g++){const w=f[g],T=o[g];if(!/^\$[^/]+$/.test(w)&&w.toLowerCase()!==T.toLowerCase()){d=!1;break}}if(d)return s}return null}function I(e){try{return p.statSync(e),!0}catch{return!1}}function z(e){return e.method==="GET"?"accept":"content-type"}async function h(e){return await import(L.pathToFileURL(e).href+"?t="+Date.now())}async function x(e){return require.cache&&delete require.cache[e],await require(e)}exports.dynamicImport=async e=>{let t;return r.serverConfig._esm?(exports.dynamicImport=h,t=await h(e)):(exports.dynamicImport=x,t=await x(e)),t};exports.appendFileFn=M;exports.cjsImport=x;exports.colorize=m;exports.esmImport=h;exports.existsSyncByMkdir=B;exports.fileExists=I;exports.findMatchingTemplatePath=q;exports.getContentTypeByPath=k;exports.getHeaderMimeTypeKey=z;exports.logger=$;exports.non_write_loggger=c;exports.safeUrlToFilename=v;exports.uniBeforeStrLog=u;exports.useContentType=F;exports.writeMockFile=_;
