"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const p=require("node:fs"),n=require("./options.cjs"),S=require("node:path"),T=require("node:fs/promises"),y=require("mime-types"),C=require("node:url"),d={black:"\x1B[30m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m",gray:"\x1B[90m",bgBlack:"\x1B[40m",bgRed:"\x1B[41m",bgGreen:"\x1B[42m",bgYellow:"\x1B[43m",bgBlue:"\x1B[44m",bgMagenta:"\x1B[45m",bgCyan:"\x1B[46m",bgWhite:"\x1B[47m",reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",italic:"\x1B[3m",underline:"\x1B[4m",blink:"\x1B[5m",reverse:"\x1B[7m",hidden:"\x1B[8m"};function m(e,...t){return t.map(r=>d[r]).join("")+e+d.reset}function u(){return m(new Date().toLocaleTimeString(),"gray")+" "+m("[Mock]","cyan","bold")}let a="";const c={success(e){if(a!==e)return a=e,n.logLevelState.isLogSuccess&&console.log(`${u()}`,m(e,"green"))},info(e){if(a!==e)return a=e,n.logLevelState.isLogInfo&&console.log(`${u()}`,e)},wran(e){if(a!==e)return a=e,n.logLevelState.isLogWarn&&console.log(`${u()}`,m(e,"yellow"))},error(e){if(a!==e)return a=e,console.log(`${u()}`,m(e,"red"))}},b={success(e){c.success(e)},info(e){c.info(e)},wran(e){c.wran(e)},error(e){c.error(e)}};function h(e){try{const t=S.dirname(e);p.existsSync(t)||p.mkdirSync(t,{recursive:!0})}catch(t){c.error(t)}}function L(e,t,r,o=!0){h(e),p.writeFile(e,t,r,i=>{i?c.wran(i):o&&c.success(`ðŸ’§ Write File Successify ${e}`)})}async function $(e,t,r,o=!0){h(e);try{await T.appendFile(e,t,r),o&&c.success(`ðŸ’§ Append File Successify ${e}`)}catch(i){c.wran(i)}}function _(e){const t=e.match(/^(https?):\/\/([^\/:]+)(?::(\d+))?(\/.*)?$/i);if(!t)return"invalid_url";const r=t[1],o=t[2],i=t[3]||(r==="https"?"443":"80"),s=(t[4]||"").replace(/\//g,"_");let l=`${o}_${i}`;return s&&s!=="_"&&(l+=s),l.replace(/[^a-z0-9_]/gi,"_").replace(/_+/g,"_").toLowerCase()}function M(e){var l;let t=y.charset(e)||n.serverConfig.encoding||n.allowCharset[0];t=t.toLocaleLowerCase();let r=y.extension(e)||n.customContentTypeToExt[e]||n.serverConfig.fileExt.slice(1),o=!((l=n.serverConfig.templateMimeType)!=null&&l.length)||n.serverConfig.templateMimeType.includes(r),i=n.serverConfig.fileExt,s=n.allowCharset.includes(t)?t:n.allowCharset[0];return o?s=n.allowCharset[0]:i=`.${r}`,{charset:t,encoding:s,isInnerTempType:o,fileExt:i,mimeType:r}}function v(e){return y.contentType(e)}function F(e,t){const o=t.replace(/^[\\/]|[\\/]$/g,"").replace(/\\/g,"/").replace(/\.[^/.]+$/,"").split("/"),i=[...e].sort((s,l)=>l.split(/[\\/]/).length-s.split(/[\\/]/).length);for(const s of i){const f=s.replace(/^[\\/]|[\\/]$/g,"").replace(/\\/g,"/").replace(/\.[^/.]+$/,"").split("/");if(f.length!==o.length)continue;let x=!0;for(let g=0;g<f.length;g++){const B=f[g],w=o[g];if(!/^\$[^/]+$/.test(B)&&B.toLowerCase()!==w.toLowerCase()){x=!1;break}}if(x)return s}return null}function k(e){try{return p.statSync(e),!0}catch{return!1}}function q(e){return e.method==="GET"?"accept":"content-type"}exports.dynamicImport=async e=>{async function t(){return await import(C.pathToFileURL(e).href+"?t="+Date.now())}async function r(){return require.cache&&delete require.cache[e],await require(e)}return n.serverConfig._esm?(exports.dynamicImport=t,t()):(exports.dynamicImport=r,r())};exports.appendFileFn=$;exports.colorize=m;exports.existsSyncByMkdir=h;exports.fileExists=k;exports.findMatchingTemplatePath=F;exports.getContentTypeByPath=v;exports.getHeaderMimeTypeKey=q;exports.logger=b;exports.non_write_loggger=c;exports.safeUrlToFilename=_;exports.uniBeforeStrLog=u;exports.useContentType=M;exports.writeMockFile=L;
