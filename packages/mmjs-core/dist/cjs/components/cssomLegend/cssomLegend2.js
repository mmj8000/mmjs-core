"use strict";const e=require("vue"),O=require("./const.js"),r=require("./methods.js"),G=require("./filters.js"),Y=require("./legend-action.js"),I=require("mmjs-share"),M=require("./help.const.js"),J={class:"cssom_legend"},Q={class:"cssom_legend__wrapper"},U=["onWheelCapture"],X=["onClick","onMouseenter","onMouseleave"],Z=["src"],ee=["viewBox"],te=["d"],ne=["innerHTML"],oe=e.defineComponent({__name:"cssomLegend",props:{ecInstance:{},eventName:{default:"rendered"},throttleTime:{default:500},disabled:{type:Boolean,default:!1},enchanceCenter:{type:Boolean,default:!0}},emits:["legendToggleSelect","highlight","downplay"],setup(i,{emit:R}){const y=e.inject(O.cssomLegendInjectKey,void 0),x=e.useTemplateRef("cssomLegendRefKey"),B=e.useTemplateRef("cssomLegendWrapRefKey"),m=e.shallowRef(),g=e.ref(),L=R,{legendToggleSelect:z,highlight:T,downplay:N}=Y.useLegendAction(m);function $(t){!i.disabled&&z(t),L("legendToggleSelect",t)}function b(t){!i.disabled&&T(t),L("highlight",t)}function q(t){!i.disabled&&N(t),L("downplay",t)}function A(t,l){var s;const n=((s=g.value)==null?void 0:s.series)??[];return G.normalizeLegendName({legend:t,series:n,legendIndex:l})}function F(t,l){if(!i.enchanceCenter)return{};if(t.type==="scroll"||t.orient==="vertical"||!B.value)return{};if(t.left!=="center"&&t.right!=="center")return{};const n=B.value[l],s=n.parentElement,o=s.getBoundingClientRect(),c=window.getComputedStyle(s),f=parseFloat(c.paddingLeft),h=parseFloat(c.paddingRight),_=parseFloat(c.borderLeftWidth),p=parseFloat(c.borderRightWidth),u=o.width-f-h-_-p;let d=0;const E=Array.from(n.children),k=parseFloat(String(t.itemGap||0))*(E.length-1),C=E.map(a=>a.clientWidth);let W=C.reduce((a,v)=>(a+=v,a<=u&&(d+=1),a),k);return W>u?{"--custom-max-width":`${C.slice(0,d).reduce((v,j)=>(v+=j,v),k)}px`}:{"--custom-max-width":`${W}px`}}const D=e.computed(()=>{var t;return((t=g.value)==null?void 0:t.legend)??[]}),K=e.computed(()=>{var t;return((t=g.value)==null?void 0:t.color)??[]}),w=I.throttle(function(){g.value=this.getOption()},i.throttleTime);function V(t,l){var s;return{"--item-color":K.value[t],"--textStyle-color":(s=l==null?void 0:l.textStyle)==null?void 0:s.color}}function H(t,l,n){var c;if(l.type!=="scroll")return;t.preventDefault();const s=(c=x.value)==null?void 0:c[n];if(!s)return;const o=M.scrollDirMap[l.orient]??M.scrollDirMap.horizontal;s.scrollTo(o(s,t.deltaY))}function P(){var t;(t=m.value)==null||t.on(i.eventName,w)}function S(){var t;(t=m.value)==null||t.off(i.eventName,w)}return e.watchEffect(()=>{var t;m.value=i.ecInstance??((t=y==null?void 0:y.value)==null?void 0:t.ec),S(),P()}),e.onScopeDispose(()=>{S()}),(t,l)=>(e.openBlock(),e.createElementBlock("div",J,[e.createElementVNode("div",Q,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(D.value,(n,s)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["cssom_legend__legend",[`cssom_legend--box-${s}`,`cssom_legend__legend--${n.type??"plain"}`,`legend_orient--${n.orient??"horizontal"}`]]),ref_for:!0,ref:"cssomLegendRefKey",style:e.normalizeStyle(e.unref(r.getCustomLegendProperty)(n)),key:s,onWheelCapture:e.withModifiers(o=>H(o,n,s),["stop"])},[e.createElementVNode("div",{ref_for:!0,ref:"cssomLegendWrapRefKey",class:e.normalizeClass(["cssom_legend__legend__wrap",[`cssom_legend__legend__wrap--${n.type??"plain"}`]]),style:e.normalizeStyle(F(n,s))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(A(n,s),(o,c)=>{var f,h,_,p,u;return e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["cssom_legend__legend_item",{"cssom_legend__legend_item--unselect":!e.unref(r.getSelectStatus)(n,o.name)}]),key:c,style:e.normalizeStyle(V(c,o)),onClick:e.withModifiers(d=>$(o.name),["stop"]),onMouseenter:e.withModifiers(d=>b(o.name),["stop"]),onMouseleave:e.withModifiers(d=>q(o.name),["stop"])},[(f=o.icon??n.icon)!=null&&f.startsWith("image://")?(e.openBlock(),e.createElementBlock("img",{key:0,class:e.normalizeClass(["cssom_legend__image_icon",{"cssom_legend__image_icon--unselect":!e.unref(r.getSelectStatus)(n,o.name)}]),src:(h=o.icon??n.icon)==null?void 0:h.slice(8),alt:""},null,10,Z)):(_=o.icon??n.icon)!=null&&_.startsWith("path://")?(e.openBlock(),e.createElementBlock("svg",{key:1,class:e.normalizeClass(["cssom_legend__svg_icon",{"cssom_legend__svg_icon--unselect":!e.unref(r.getSelectStatus)(n,o.name)}]),viewBox:e.unref(r.calculateViewBox)((p=o.icon??n.icon)==null?void 0:p.slice(7))},[e.createElementVNode("path",{d:(u=o.icon??n.icon)==null?void 0:u.slice(7)},null,8,te)],10,ee)):(e.openBlock(),e.createElementBlock("div",{key:2,class:e.normalizeClass(["cssom_legend__rect",[...e.unref(r.getIconModified)(o.icon??n.icon,o)]])},null,2)),e.createElementVNode("div",{class:"cssom_legend__text",innerHTML:e.unref(r.formatter)(n,o.name)},null,8,ne)],46,X)}),128))],6)],46,U))),128))])]))}});module.exports=oe;
