"use strict";const e=require("vue"),$=require("./const.js"),c=require("./methods.js"),b=require("./filters.js"),V=require("./legend-action.js");require("../../mmjs-share/src/index.js");const H=require("../../mmjs-share/src/utils.js"),A={class:"cssom_legend"},F={class:"cssom_legend__wrapper"},O=["onClick","onMouseenter","onMouseleave"],P=["src"],W=["viewBox"],j=["d"],D=["innerHTML"],K=e.defineComponent({__name:"cssomLegend",props:{ecInstance:{},eventName:{default:"rendered"},throttleTime:{default:500},disabled:{type:Boolean,default:!1}},emits:["legendToggleSelect","highlight","downplay"],setup(l,{emit:y}){const u=e.inject($.cssomLegendInjectKey,void 0),a=e.shallowRef(),r=e.ref(),m=y,{legendToggleSelect:E,highlight:S,downplay:w}=V.useLegendAction(a);function L(n){!l.disabled&&E(n),m("legendToggleSelect",n)}function M(n){!l.disabled&&S(n),m("highlight",n)}function C(n){!l.disabled&&w(n),m("downplay",n)}function x(n,i){var s;const t=((s=r.value)==null?void 0:s.series)??[];return b.normalizeLegendName({legend:n,series:t,legendIndex:i})}const z=e.computed(()=>{var n;return((n=r.value)==null?void 0:n.legend)??[]}),N=e.computed(()=>{var n;return((n=r.value)==null?void 0:n.color)??[]}),_=H.throttle(function(){r.value=this.getOption()},l.throttleTime);function q(n,i){var s;return{"--item-color":N.value[n],"--textStyle-color":(s=i==null?void 0:i.textStyle)==null?void 0:s.color}}function T(){var n;(n=a.value)==null||n.on(l.eventName,_)}function d(){var n;(n=a.value)==null||n.off(l.eventName,_)}return e.watchEffect(()=>{var n;a.value=l.ecInstance??((n=u==null?void 0:u.value)==null?void 0:n.ec),d(),T()}),e.onScopeDispose(()=>{d()}),(n,i)=>(e.openBlock(),e.createElementBlock("div",A,[e.createElementVNode("div",F,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(z.value,(t,s)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["cssom_legend__legend",[`cssom_legend--box-${s}`,`cssom_legend__legend--${t.type??"plain"}`]]),style:e.normalizeStyle(e.unref(c.getCustomLegendProperty)(t)),key:s},[e.createElementVNode("div",{class:e.normalizeClass(["cssom_legend__legend__wrap",[`cssom_legend__legend__wrap--${t.type??"plain"}`]])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(x(t,s),(o,g)=>{var f,v,h,p,k;return e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["cssom_legend__legend_item",{"cssom_legend__legend_item--unselect":!e.unref(c.getSelectStatus)(t,o.name)}]),key:g,style:e.normalizeStyle(q(g,o)),onClick:e.withModifiers(B=>L(o.name),["stop"]),onMouseenter:e.withModifiers(B=>M(o.name),["stop"]),onMouseleave:e.withModifiers(B=>C(o.name),["stop"])},[(f=o.icon??t.icon)!=null&&f.startsWith("image://")?(e.openBlock(),e.createElementBlock("img",{key:0,class:e.normalizeClass(["cssom_legend__image_icon",{"cssom_legend__image_icon--unselect":!e.unref(c.getSelectStatus)(t,o.name)}]),src:(v=o.icon??t.icon)==null?void 0:v.slice(8),alt:""},null,10,P)):(h=o.icon??t.icon)!=null&&h.startsWith("path://")?(e.openBlock(),e.createElementBlock("svg",{key:1,class:e.normalizeClass(["cssom_legend__svg_icon",{"cssom_legend__svg_icon--unselect":!e.unref(c.getSelectStatus)(t,o.name)}]),viewBox:e.unref(c.calculateViewBox)((p=o.icon??t.icon)==null?void 0:p.slice(7))},[e.createElementVNode("path",{d:(k=o.icon??t.icon)==null?void 0:k.slice(7)},null,8,j)],10,W)):(e.openBlock(),e.createElementBlock("div",{key:2,class:e.normalizeClass(["cssom_legend__rect",[...e.unref(c.getIconModified)(o.icon??t.icon,o)]])},null,2)),e.createElementVNode("div",{class:"cssom_legend__text",innerHTML:e.unref(c.formatter)(t,o.name)},null,8,D)],46,O)}),128))],2)],6))),128))])]))}});module.exports=K;
