"use strict";const e=require("vue"),Y=require("./const.js"),g=require("./methods.js"),T=require("./filters.js"),J=require("./legend-action.js"),Q=require("mmjs-share"),z=require("./help.const.js"),U=require("./tools.js"),x=require("./transform.js"),X={class:"cssom_legend"},Z={class:"cssom_legend__wrapper"},I=["onWheelCapture"],ee=["onClick","onMouseenter","onMouseleave"],te=["src"],ne=["viewBox"],oe=["d"],se=["innerHTML"],le=e.defineComponent({__name:"cssomLegend",props:{ecInstance:{},eventName:{default:"rendered"},throttleTime:{default:500},disabled:{type:Boolean,default:!1},enchanceCenter:{type:Boolean,default:!0},transfromFn:{}},emits:["legendToggleSelect","highlight","downplay"],setup(c,{emit:N}){const w=e.inject(Y.cssomLegendInjectKey,void 0),$=e.useTemplateRef("cssomLegendRefKey"),k=e.useTemplateRef("cssomLegendWrapRefKey"),C=e.shallowRef(),E=e.ref(),B=N;e.watchEffect(()=>{typeof c.transfromFn=="function"&&(x.transfromState.transform=c.transfromFn)});const{legendToggleSelect:b,highlight:A,downplay:F}=J.useLegendAction(C);function q(t){!c.disabled&&b(t),B("legendToggleSelect",t)}function D(t){!c.disabled&&A(t),B("highlight",t)}function K(t){!c.disabled&&F(t),B("downplay",t)}function P(t,r){var s;const n=((s=E.value)==null?void 0:s.series)??[];return T.normalizeLegendName({legend:t,series:n,legendIndex:r})}function V(t,r){if(!c.enchanceCenter)return{};if(t.type==="scroll"||t.orient==="vertical"||!k.value)return{};if(t.left!=="center"&&t.right!=="center")return{};try{const n=k.value[r],s=n.parentElement,o=s.getBoundingClientRect(),l=window.getComputedStyle(s),m=parseFloat(l.paddingLeft),p=parseFloat(l.paddingRight),h=parseFloat(l.borderLeftWidth),f=parseFloat(l.borderRightWidth),a=o.width-m-p-h-f;let u=0;const _=Array.from(n.children),v=parseFloat(String(t.itemGap||0))*(_.length-1),y=_.map(i=>i.clientWidth);let S=y.reduce((i,d)=>(i+=d,i<=a&&(u+=1),i),v);return S>a?{"--custom-max-width":`${y.slice(0,u).reduce((d,L)=>(d+=L,d),v)}px`}:{"--custom-max-width":`${S}px`}}catch(n){console.error(`[Enhance Center]: ${n}`)}}const H=e.computed(()=>{var t;return((t=E.value)==null?void 0:t.legend)??[]}),W=e.computed(()=>{var r;let t=(r=E.value)==null?void 0:r.color;return Array.isArray(t)?t:t?[t]:[]}),M=Q.throttle(function(){E.value=this.getOption()},c.throttleTime);function O(t,r,n){var f,a,u,_,v,y,S,i,d,L;let s=(a=(f=n==null?void 0:n.serie)==null?void 0:f.itemStyle)==null?void 0:a.color;const o={dataIndex:t,seriesIndex:r,value:(_=(u=n.serie)==null?void 0:u.data)==null?void 0:_[t],data:(y=(v=n.serie)==null?void 0:v.data)==null?void 0:y[t],seriesType:(S=n.serie)==null?void 0:S.type,name:(i=n.serie)==null?void 0:i.name,seriesName:n==null?void 0:n.name,color:null,componentIndex:r,componentSubType:(d=n.serie)==null?void 0:d.type,componentType:"customSeries"};s&&W.value.splice(t,0,s);let l=W.value[t];const m={},p=(n==null?void 0:n.textStyle)??{};g.forPropertsEffect(p,m,"textStyle",T.transformCss);const h=typeof l=="function"?l(o):l;return{"--item-color":x.transfromState.transformGradientCss(h),"--data-item-icon":(L=n.icon)==null?void 0:L.replaceAll("image://",""),...m}}function j(t,r,n){var l;if(r.type!=="scroll")return;t.preventDefault();const s=(l=$.value)==null?void 0:l[n];if(!s)return;const o=z.scrollDirMap[r.orient]??z.scrollDirMap.horizontal;s.scrollTo(o(s,t.deltaY))}function G(){var t;(t=C.value)==null||t.on(c.eventName,M)}function R(){var t;(t=C.value)==null||t.off(c.eventName,M)}return e.watchEffect(()=>{var t;C.value=c.ecInstance??((t=w==null?void 0:w.value)==null?void 0:t.ec),R(),G()}),e.onScopeDispose(()=>{R()}),(t,r)=>(e.openBlock(),e.createElementBlock("div",X,[e.createElementVNode("div",Z,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(H.value,(n,s)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["cssom_legend__legend",[`cssom_legend--box-${s}`,`cssom_legend__legend--${n.type??"plain"}`,`legend_orient--${n.orient??"horizontal"}`]]),ref_for:!0,ref:"cssomLegendRefKey",style:e.normalizeStyle(e.unref(g.getCustomLegendProperty)(n)),key:s,onWheelCapture:e.withModifiers(o=>j(o,n,s),["stop"])},[e.createElementVNode("div",{ref_for:!0,ref:"cssomLegendWrapRefKey",class:e.normalizeClass(["cssom_legend__legend__wrap",[`cssom_legend__legend__wrap--${n.type??"plain"}`]]),style:e.normalizeStyle(V(n,s))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(P(n,s),(o,l)=>{var m,p,h,f,a;return e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["cssom_legend__legend_item",{"cssom_legend__legend_item--unselect":!e.unref(g.getSelectStatus)(n,o.name)}]),key:l,style:e.normalizeStyle(O(l,s,o)),onClick:e.withModifiers(u=>q(o.name),["stop"]),onMouseenter:e.withModifiers(u=>D(o.name),["stop"]),onMouseleave:e.withModifiers(u=>K(o.name),["stop"])},[(m=o.icon??n.icon)!=null&&m.startsWith("image://")?(e.openBlock(),e.createElementBlock("img",{key:0,class:e.normalizeClass(["cssom_legend__image_icon",{"cssom_legend__image_icon--unselect":!e.unref(g.getSelectStatus)(n,o.name)}]),src:(p=o.icon??n.icon)==null?void 0:p.slice(8),alt:""},null,10,te)):(h=o.icon??n.icon)!=null&&h.startsWith("path://")?(e.openBlock(),e.createElementBlock("svg",{key:1,class:e.normalizeClass(["cssom_legend__svg_icon",{"cssom_legend__svg_icon--unselect":!e.unref(g.getSelectStatus)(n,o.name)}]),viewBox:e.unref(U.calculateViewBox)((f=o.icon??n.icon)==null?void 0:f.slice(7))},[e.createElementVNode("path",{d:(a=o.icon??n.icon)==null?void 0:a.slice(7)},null,8,oe)],10,ne)):(e.openBlock(),e.createElementBlock("div",{key:2,class:e.normalizeClass(["cssom_legend__rect",[...e.unref(g.getIconModified)(o.icon??n.icon,o)]])},null,2)),e.createElementVNode("div",{class:"cssom_legend__text",innerHTML:e.unref(g.formatter)(n,o.name)},null,8,se)],46,ee)}),128))],6)],46,I))),128))])]))}});module.exports=le;
