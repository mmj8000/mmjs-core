"use strict";const e=require("vue"),O=require("./const.js"),a=require("./methods.js"),G=require("./filters.js"),Y=require("./legend-action.js"),I=require("mmjs-share"),M=require("./help.const.js"),J=require("./tools.js"),Q=require("./transform.js"),U={class:"cssom_legend"},X={class:"cssom_legend__wrapper"},Z=["onWheelCapture"],ee=["onClick","onMouseenter","onMouseleave"],te=["src"],ne=["viewBox"],oe=["d"],se=["innerHTML"],le=e.defineComponent({__name:"cssomLegend",props:{ecInstance:{},eventName:{default:"rendered"},throttleTime:{default:500},disabled:{type:Boolean,default:!1},enchanceCenter:{type:Boolean,default:!0},transfromFn:{}},emits:["legendToggleSelect","highlight","downplay"],setup(c,{emit:R}){const y=e.inject(O.cssomLegendInjectKey,void 0),x=e.useTemplateRef("cssomLegendRefKey"),w=e.useTemplateRef("cssomLegendWrapRefKey"),m=e.shallowRef(),f=e.ref(),L=R;e.watchEffect(()=>{typeof c.transfromFn=="function"&&(Q.transfromState.transform=c.transfromFn)});const{legendToggleSelect:z,highlight:T,downplay:F}=Y.useLegendAction(m);function N(t){!c.disabled&&z(t),L("legendToggleSelect",t)}function $(t){!c.disabled&&T(t),L("highlight",t)}function b(t){!c.disabled&&F(t),L("downplay",t)}function q(t,l){var s;const n=((s=f.value)==null?void 0:s.series)??[];return G.normalizeLegendName({legend:t,series:n,legendIndex:l})}function A(t,l){if(!c.enchanceCenter)return{};if(t.type==="scroll"||t.orient==="vertical"||!w.value)return{};if(t.left!=="center"&&t.right!=="center")return{};const n=w.value[l],s=n.parentElement,o=s.getBoundingClientRect(),i=window.getComputedStyle(s),g=parseFloat(i.paddingLeft),h=parseFloat(i.paddingRight),_=parseFloat(i.borderLeftWidth),p=parseFloat(i.borderRightWidth),u=o.width-g-h-_-p;let d=0;const E=Array.from(n.children),k=parseFloat(String(t.itemGap||0))*(E.length-1),C=E.map(r=>r.clientWidth);let W=C.reduce((r,v)=>(r+=v,r<=u&&(d+=1),r),k);return W>u?{"--custom-max-width":`${C.slice(0,d).reduce((v,j)=>(v+=j,v),k)}px`}:{"--custom-max-width":`${W}px`}}const D=e.computed(()=>{var t;return((t=f.value)==null?void 0:t.legend)??[]}),K=e.computed(()=>{var t;return((t=f.value)==null?void 0:t.color)??[]}),B=I.throttle(function(){f.value=this.getOption()},c.throttleTime);function V(t,l){var s;return{"--item-color":K.value[t],"--textStyle-color":(s=l==null?void 0:l.textStyle)==null?void 0:s.color}}function H(t,l,n){var i;if(l.type!=="scroll")return;t.preventDefault();const s=(i=x.value)==null?void 0:i[n];if(!s)return;const o=M.scrollDirMap[l.orient]??M.scrollDirMap.horizontal;s.scrollTo(o(s,t.deltaY))}function P(){var t;(t=m.value)==null||t.on(c.eventName,B)}function S(){var t;(t=m.value)==null||t.off(c.eventName,B)}return e.watchEffect(()=>{var t;m.value=c.ecInstance??((t=y==null?void 0:y.value)==null?void 0:t.ec),S(),P()}),e.onScopeDispose(()=>{S()}),(t,l)=>(e.openBlock(),e.createElementBlock("div",U,[e.createElementVNode("div",X,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(D.value,(n,s)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["cssom_legend__legend",[`cssom_legend--box-${s}`,`cssom_legend__legend--${n.type??"plain"}`,`legend_orient--${n.orient??"horizontal"}`]]),ref_for:!0,ref:"cssomLegendRefKey",style:e.normalizeStyle(e.unref(a.getCustomLegendProperty)(n)),key:s,onWheelCapture:e.withModifiers(o=>H(o,n,s),["stop"])},[e.createElementVNode("div",{ref_for:!0,ref:"cssomLegendWrapRefKey",class:e.normalizeClass(["cssom_legend__legend__wrap",[`cssom_legend__legend__wrap--${n.type??"plain"}`]]),style:e.normalizeStyle(A(n,s))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(q(n,s),(o,i)=>{var g,h,_,p,u;return e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["cssom_legend__legend_item",{"cssom_legend__legend_item--unselect":!e.unref(a.getSelectStatus)(n,o.name)}]),key:i,style:e.normalizeStyle(V(i,o)),onClick:e.withModifiers(d=>N(o.name),["stop"]),onMouseenter:e.withModifiers(d=>$(o.name),["stop"]),onMouseleave:e.withModifiers(d=>b(o.name),["stop"])},[(g=o.icon??n.icon)!=null&&g.startsWith("image://")?(e.openBlock(),e.createElementBlock("img",{key:0,class:e.normalizeClass(["cssom_legend__image_icon",{"cssom_legend__image_icon--unselect":!e.unref(a.getSelectStatus)(n,o.name)}]),src:(h=o.icon??n.icon)==null?void 0:h.slice(8),alt:""},null,10,te)):(_=o.icon??n.icon)!=null&&_.startsWith("path://")?(e.openBlock(),e.createElementBlock("svg",{key:1,class:e.normalizeClass(["cssom_legend__svg_icon",{"cssom_legend__svg_icon--unselect":!e.unref(a.getSelectStatus)(n,o.name)}]),viewBox:e.unref(J.calculateViewBox)((p=o.icon??n.icon)==null?void 0:p.slice(7))},[e.createElementVNode("path",{d:(u=o.icon??n.icon)==null?void 0:u.slice(7)},null,8,oe)],10,ne)):(e.openBlock(),e.createElementBlock("div",{key:2,class:e.normalizeClass(["cssom_legend__rect",[...e.unref(a.getIconModified)(o.icon??n.icon,o)]])},null,2)),e.createElementVNode("div",{class:"cssom_legend__text",innerHTML:e.unref(a.formatter)(n,o.name)},null,8,se)],46,ee)}),128))],6)],46,Z))),128))])]))}});module.exports=le;
